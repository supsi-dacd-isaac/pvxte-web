{% extends 'base.html' %}

{% block content %}
    {% if 'username' in session.keys() and session['username'] != '' %}
    <nav class="navbar navbar-expand-lg navbar-light">
        <ul class="navbar-nav">
              <li class="nav-item active">
                <a class="nav-link"><h3>{{ gettext('Simulation results') }} <i>{{ sim_name }}</i>:</h3></a>
              </li>
        </ul>
    </nav>
    <br>
    <div class="table-container">
        <div class="table-left">
            <table class="table">
                <thead>
                    <tr>
                        <td colspan="3">{{ gettext('Buses and batteries sizing') }} </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="text-align: left;">{{ gettext('Capacity of a battery pack') }}</td>
                        <td style="text-align: right;">{{ input_bus_model_data['batt_pack_capacity'] }} kWh</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">{{ gettext('Minimum required battery packs') }}</td>
                        <td style="text-align: right;">{{ input_bus_model_data['min_required_batt_packs'] }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">{{ gettext('Maximum allowed battery packs') }}</td>
                        <td style="text-align: right;">{{ input_bus_model_data['max_allowed_batt_packs'] }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">{{ gettext('Empty weight of a bus without battery') }}</td>
                        <td style="text-align: right;">{{ (input_bus_model_data['empty_bus_weight']|int)/1000 }} ton</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;" id="align-left-td">{{ gettext('Length') }}</td>
                        <td style="text-align: right;">{{ input_bus_model_data['length'] }} m</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">{{ gettext('Weight of a battery pack') }}</td>
                        <td style="text-align: right;">{{ input_bus_model_data['batt_pack_weight'] }} kg</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">{{ gettext('Pantograph maximum charging power') }}</td>
                        <td style="text-align: right;">{{ input_pars['p_max'] }} kW</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;">{{ gettext('Maximum charging power at deposit') }}</td>
                        <td style="text-align: right;">{{ input_pars['pd_max'] }} kW</td>
                    </tr>
                    <tr>
                        <td colspan="2"></td>
                    </tr>
                    <tr>
                        <td style="text-align: left;"><b>{{ gettext('Number of buses') }}</b></td>
                        <td style="text-align: right;">{{ bus_data['number'] }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;"><b>{{ gettext('Battery packs for each bus') }}</b></td>
                        <td style="text-align: right;">{{ bus_data['battery_packs_number'] }}</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;"><b>{{ gettext('Total capacity of a bus') }}</b></td>
                        <td style="text-align: right;">{{ bus_data['battery_packs_capacity']|int }} kWh</td>
                    </tr>
                    <tr>
                        <td style="text-align: left;"><b>{{ gettext('Minimum number of drivers') }}</b></td>
                        <td style="text-align: right;">{{ data['min_num_drivers'] }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="table-center">
            <table class="table">
<!--                <thead>-->
<!--                <tr>-->
<!--                    <td colspan="3">{{ gettext('Investment costs') }}</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td></td><td>{{ gettext('Cost') }} [kCHF/{{ gettext('unit') }}]</td><td>{{ gettext('Lifetime') }} [{{ gettext('years') }}]</td>-->
<!--                </tr>-->
<!--                </thead>-->
<!--                <tbody>-->
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Bus') }}</td>-->
<!--                    <td>{{ ((capex_features['capex_bus_cost']|int)/1000)|int }}</td>-->
<!--                    <td>{{ capex_features['capex_bus_lifetime']|int }}</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Battery') }}</td>-->
<!--                    <td>{{ ((capex_features['capex_battery_cost']|int)/1000)|int }}</td>-->
<!--                    <td>{{ capex_features['capex_battery_lifetime']|int }}</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Deposit charger') }}</td>-->
<!--                    <td>{{ ((capex_features['capex_charger_cost']|int)/1000)|int }}</td>-->
<!--                    <td>{{ capex_features['capex_charger_lifetime']|int }}</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Pantographs') }}</td>-->
<!--                    <td>{{ ((capex_features['capex_panto_cost']|int)/1)|int }}</td>-->
<!--                    <td>{{ capex_features['capex_panto_lifetime']|int }}</td>-->
<!--                </tr>-->
<!--                </tbody>-->
<!--                <thead>-->
                <thead>
                <tr>
                    <td colspan="3">{{ gettext('Investment costs') }} [kCHF/{{ gettext('year')}}]</td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td colspan="2" style="text-align: left;">{{ gettext('Buses') }}</td>
                    <td style="text-align: right;">{{ ((capex_opex_costs['capex_bus_cost']|int)/1)|int }}</td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: left;">{{ gettext('Batteries') }}</td>
                    <td style="text-align: right;">{{ ((capex_opex_costs['capex_batt_cost']|int)/1)|int }}</td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: left;">{{ gettext('Deposit charger') }}
                    <td style="text-align: right;">{{ ((capex_opex_costs['capex_depo_charger_cost']|int)/1)|int }}</td>
                </tr>
               <tr>
                    <td colspan="2" style="text-align: left;">{{ gettext('Other chargers (e.g. pantographs)') }}
                    <td style="text-align: right;">{{ ((capex_opex_costs['capex_not_depo_charger_cost']|int)/1)|int }}</td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: left;">{{ gettext('Connection fee') }}</td>
                    <td style="text-align: right;">{{ ((capex_opex_costs['capex_add_fee']|int)/1)|int }}</td>
                </tr>
                <tr><td colspan="3"></td></tr>
                </tbody>
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Interest rate') }}</td>-->
<!--                    <td colspan="2">{{ capex_features['capex_interest_rate']|int }} %</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Additional fee') }}</td>-->
<!--                    <td colspan="2">{{ ((capex_features['capex_additional_fee']|int)/1000)|int }} CHF</td>-->
<!--                </tr>-->
                <tr>
                    <td colspan="2" style="text-align: left;"><b>{{ gettext('Total') }}</b></td>
                    <td style="text-align: right;"><b>{{ capex_opex_costs['capex_cost']|int }}</b></td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: left;"><b>{{ gettext('Total') }} ({{ gettext('diesel') }})</b></td>
                    <td style="text-align: right;"><b>{{ capex_opex_costs['capex_cost_diesel']|int }}</b></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="table-right">
            <table class="table">
                <thead>
                <tr>
                    <td colspan="3">{{ gettext('Operational costs') }} [kCHF/{{ gettext('year') }}]</td>
                </tr>
<!--                </thead>-->
<!--                <tbody>-->
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Energy tariff') }}</td>-->
<!--                    <td style="text-align: right;">{{ opex_features['opex_energy_tariff'] }} CHF/kWh</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Buses maintenance') }}</td>-->
<!--                    <td style="text-align: right;">{{ opex_features['opex_buses_maintainance'] }} CHF/km</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Buses efficiency') }}</td>-->
<!--                    <td style="text-align: right;">{{ opex_features['opex_bus_efficiency_sim']|round(2) }} kWh/km</td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td style="text-align: left;">{{ gettext('Annual usage') }}</td>-->
<!--                    <td style="text-align: right;">{{ opex_features['opex_annual_usage'] }} km</td>-->
<!--                </tr>-->
<!--                <tr><td colspan="2"></td></tr>-->
<!--                <tr><td colspan="2"></td></tr>-->
<!--                </tbody>-->
<!--            </table>-->
<!--            <table class="table">-->
                <thead>
                <tr>
                    <td style="text-align: center;">{{ gettext('Cost') }}</td>
                    <td style="text-align: center;">{{ gettext('Electrical') }}</td>
                    <td style="text-align: center;">{{ gettext('Diesel') }}</td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td style="text-align: left;">{{ gettext('Maintenance') }}</td>
                    <td style="text-align: center;">{{ capex_opex_costs['opex_cost_maintenance']|int }} </td>
                    <td style="text-align: center;">{{ capex_opex_costs['opex_cost_maintenance_diesel']|int }} </td>
                </tr>
                <tr>
                    <td style="text-align: left;">{{ gettext('Consumption') }}</td>
                    <td style="text-align: center;">{{ capex_opex_costs['opex_cost_consumption']|int }} </td>
                    <td style="text-align: center;">{{ capex_opex_costs['opex_cost_consumption_diesel']|int }} </td>
                </tr>
                <tr>
                    <td style="text-align: left;"><b>{{ gettext('Total') }}</b></td>
                    <td style="text-align: center;"><b>{{ capex_opex_costs['opex_cost']|int }}</b></td>
                    <td style="text-align: center;"><b>{{ capex_opex_costs['opex_cost_diesel']|int }}</b></td>
                </tr>
                <tr style="border: white;"><td colspan="3"></td></tr>
                <tr style="border: white;"><td colspan="3"></td></tr>
                </tbody>
                <thead>
                <tr>
                    <td colspan="3">{{ gettext('TTW emissions saved (diesel comparison)') }}:</td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td style="text-align: left;"><b>CO<sub>2</sub></b></td>
                    <td style="text-align: left;"></td>
                    <td style="text-align: right;">{{ emissions['CO2']['value']|round(2) }} {{ emissions['CO2']['unit'] }}/{{ gettext('year') }}</td>
                </tr>
                <tr>
                    <td style="text-align: left;"><b>NO<sub>X</sub></b></td>
                    <td style="text-align: left;"></td>
                    <td style="text-align: right;">{{ emissions['NOx']['value']|round(2) }} {{ emissions['NOx']['unit'] }}/{{ gettext('year') }}</td>
                </tr>
                <tr>
                    <td style="text-align: left;"><b>PM10</b></td>
                    <td style="text-align: left;"></td>
                    <td style="text-align: right;">{{ emissions['PM10']['value']|round(2) }} {{ emissions['PM10']['unit'] }}/{{ gettext('year') }}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <br><br><br><br>
    <div class="graphs-container">
        <div class="plot-container">
            <div id="plot" class="plot"></div>
        </div>
        <script>
            var plotDiv = document.getElementById('plot');
            var data = [
                {
                    x: {{ capex_opex_costs['capex_opex_years'] | safe }},
                    y: {{ capex_opex_costs['capex_opex_cost_at_year'] | safe }},
                    mode: 'lines+markers',
                    name: '{{ gettext('Electrical') }}',
                    line: {color: 'green'}
                },
                {
                    x: {{ capex_opex_costs['capex_opex_years'] | safe }},
                    y: {{ capex_opex_costs['capex_opex_cost_at_year_diesel'] | safe }},
                    mode: 'lines+markers',
                    name: '{{ gettext('Diesel') }}',
                    line: {color: 'red'}
                }
            ];
            var layout = {
                title: '{{ gettext('Break point analysis') }}',
                xaxis: { title: '{{ gettext('Year') }}' },
                yaxis: { title: '{{ gettext('Cost') }} [M CHF]' },
                responsive: true
            };

            // Create the plot
            Plotly.newPlot(plotDiv, data, layout);
        </script>

        <div class="plot-container">
            <div id="bargraph" class="plot">
                {{ plot_div|safe }}
            </div>
        </div>
    </div>

    {% endif %}

<footer>
    {% include 'footer_logged.html' %}
</footer>

{% endblock %}